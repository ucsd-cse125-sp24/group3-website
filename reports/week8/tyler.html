<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torchlight Games</title>
    <link rel="stylesheet" href="../individualreport.css">

    <script>
        var playing = false;
        let audio = new Audio('./assets/tyler/dancing_queen.mp3');
        audio.volume = 0.5;
        document.addEventListener("DOMContentLoaded", () => {
            let btn = document.getElementById('light-switch');
            btn.addEventListener('click', () => {
                if (playing) {
                    return;
                }
                playing = true;

                let switch_sound = new Audio('./assets/tyler/switch.mp3');
                switch_sound.play();
                btn.insertAdjacentHTML("afterend", `
                    <style>
                        * {
                            background-color: black;
                        }
                        h1 {
                            color: #101872;
                        }
                        h2 {
                            color: #4e1897;
                        }
                        h3 {
                            color: #8742b0;
                        }
                        h4 {
                            color: #be3fd0;
                        }
                `);

                setTimeout(() => {
                    audio.play();
                    let body = document.getElementsByTagName('body')[0];
                    body.insertAdjacentHTML("afterbegin", `
                        <style>
                            #disco-container {
                                position: sticky;
                                height: 0px;
                                overflow: visible;
                                top: 0;
                            }

                            #disco {
                                position: relative;
                                right: -70vw;
                                z-index: -1;
                            }
                        </style>
                        <div id="disco-container">
                            <img id="disco" src="./assets/tyler/disco.gif"></img>
                        </div>
                    `);
                }, 1500);

            });
        });
    </script>
<body>
    <style>
        * {
            color: white;
        }
        p {
            line-height: 2;
        }
        table {
            text-align: center; 
            border-collapse: collapse; 
            border: 1px solid white;
        } 
        table * {
            border: 1px solid white;
            padding: 1em;
        }
    </style>

    <h1> Tyler's Week 8 Individual Report</h1>

    <img id="light-switch" src="./assets/tyler/switch.png"></img>

    <h2>What were your concrete goals for the week?</h2>
    <p>My concrete goals for the week were to</p>
    <ul>
        <li>Finish the directional audio system</li>
        <li>Move around elsewhere as needed</li>
    </ul>

    <h2>What goals were you able to accomplish?</h2>

    <p>I was able to finish the directional audio system relatively quickly, and then stayed true to my word
        and hopped around all over the codebase. I was mainly motivated by things we learned during our first
        playtest, and also some things that had been bothering me for a bit.
    </p>

    <h3>Directional Audio</h3>

    <p> The first thing I did was continue my work from the previous week and finalize the directional
        audio system. SFML took care of all of the specific math for directional audio, and made it really
        easy to think of terms of positions and attenuations and other attributes of the sound effects.
    </p> 
    
    <p> The way it works is that the server maintains a table of all active sound effects
        with their position, volume, attenuation, and minimum distance values. Upon creation the server
        sends a PLAY sound command to each client who is close enough to hear that sound. Then each tick
        the server decrements the time_remaining value of each sound effect. Once the sound effect is
        done playing, the server sends a DO_DELETE command to the clients so that the clients can clean up
        the sound effect (which is important because SFML limits you to 255 active sound effects).
    </p>

    <p>
        This works well for shorter, more dynamic sound effects (slime jumping, player footsteps, crush trap, etc...) but
        breaks down for more "static" sound effects that are always playing, which in this case is the torch
        crackling sound effect. To solve this, I ended up piggy backing on Anthony's light source event packet
        which tells the players the 16 closest light sources for rendering, and also making the client reserve
        16 sound effects which are always actively playing the torch sound effect on a loop, but have their
        positions updated as the player moves around and the set of 16 closest light sources changes.
    </p>

    <p>
        This ended up working very well, and I'm very happy with how it turned out.
    </p>

    <h3>Refactor Room Design and Procedural Generation</h3>

    <p>
        By this point we were ready to do our first playtest. Wednesday night we spent 2ish hours
        on a Discord call getting all 4 of our outstanding branches merged in so we could playtest
        the following morning at our meeting. This merge actually ended up being much more difficult
        than anticipated, not because of confusing merge conflicts, but just because of things that
        broke in the system when integrating the dungeon master logic for the first time, but we were
        able to figure it out in one sitting.
    </p>

    <p>
        The biggest immediate thing I realized from the playtest was that the current maze design
        was not the best. There were certain room types that were too complicated for players to
        navigate, which became a big problem if there was one specific route they had to go through
        to find the orb or exit. In addition, even before the playtest I had known there were various problems
        in the procedural algorithm itself, the chief of these being that the algorithm
        didn't distinguish between the weight of a 10x10, 20x20, or 40x40 room tiles,
        so each of these counted equally towards the room quota despite the fact that 40x40 rooms are
        16x the size of a 10x10. Lastly, I realized that the 40x40 rooms were too hard to design well,
        and didn't give much benefit over making a lot more interesting 20x20 and 10x10 rooms.
    </p>
    <p>
        So I set out initially to do three things:

        <ol>
            <li><pre>rm -rf ~/cse125/group3/maps/rooms/40x40/*</pre></li>
            <li>Redesign lots of the rooms to be more open and have less tiny corridors</li>
            <li>Make the algorithm weight 20x20 rooms 4 times as much as 10x10 rooms towards the quota.</li>
        </ol>
    </p>
    <p>
        I made all of these changes, and then ran into a new bug which was already in the code, but only starting
        appearing after adding new room types. Funnily enough it only showed up in about every 1/10-20 mazes,
        but the first maze I generated had it, which helped a lot because it would have been annoying if it slipped
        under the radar.
    </p>
    <pre>
                                        ##########                                                  
                                        ###!oo!###                                                  
                                        ##......##                                                  
                                        #!......!#                                                  
                                        #{......}#                                                  
                                        #!......!#                                                  
                                        ##......##                                                  
                                        ###!..!###                                                  
                                        ####..####                                                  
                                        ####..####   ####                                           
                                        ####..########..#####                                       
                                        #vv#...|XXXX|......}#                                       
                                        #..#...|XXXX|......##                                       
                                       ##..![#########..!..##                                       
                                       #.......|XXXX|.......#                                       
                                       #.......|XXXX|.......#                                       
                                       ##..!..########..!..##                                       
                                        #..#....|..|....#..#                                        
                                        #..#....|..|....#..#                                        
                                        #..#....|..|....#..#                                        
                                       ##..#....|..|....#..#                                        
                                       #{..#....|..|....#..#                                        
                                       ##..#....|..|....#..#                                        
                                       ##..!..########..!..##                                       
                                       #.......|XXXX|.......#                                       
                                       #.......|XXXX|.......#                                       
                                       ##..!##[##########..##                                       
                                        #......|XXXX|...#..#                                        
                                        #......|XXXX|...#^^#                                        
                                 ####   ####..########..####   ####      ####      ####             
                              ####..########..########..########..########..########..####          
                              #..|..|..#####..########..}####..|..|..#####..########..####          
                              #..|..|..####{..########..#####..|..|..#####..########..####          
                             ##--+--+--####!..!######!--!####--+--+--#####..########..#####         
                             #...|]!|......|..|................|]!|..........X............#         
                             #...|![|......|..|................|![|...............X.......#         
                             ##--+--+--####!..!#####]!--!####--+--+--#####..###..###..#####         
                              #..|..|..#####..########..#####..|..|..#####..###.X###.X####          
                              #..|..|..#####..##p..p##..#####..|..|..#####X.###..###..####          
                              ####..########..#!....!#..########..########..###..###..####          
                              ##############..#!....!#..##################..###..###..####          
                              ##############..##s..p##..########vv########..###X.###..####          
                             ###############..###FF###..########..########.X###..###..####          
                             #![######[!#[#!--!##FF##!..!###![##..########..###..###X.#####         
                             #.......................|..|.........!###.......X............#         
                             #.......................|..|.........####.............X......#         
                             #!##!..!##!###!--!##]###!..!###!##!..########..########..#####         
                             #####..########..########..}#######..}#######..########..####          
                              ####..}######{..########..########..########..########..####          
                              ###!..!#######..########..#######!..!#######..########..####   ####   
                              ###!..!#######..########..########..########..########..########..####
                              ###[..|..#####..########..#####..|..|..##vv#...|XXXX|......}#..|..|..#
                              ####..|..#####..########..#####..|..|..##..#...|XXXX|......##..|..|..#
                              ###!..!--#####..########..#####--+--+--##..![#########..!..##--+--+--#
                              ####.............X...............|]!|..........|XXXX|..........|]!|..#
                              ####..................X..........|![|..........|XXXX|..........|![|..#
                              ###!..!--!####..###..###..#####--+--+--##..!..########..!..##--+--+--#
                              ####..|..#####..###.X###.X#####..|..|..##..#....|..|....#..##..|..|..#
                              ####..|..#####X.###..###..#####..|..|..##..#....|..|....#..##..|..|..#
   ####      ####             ###!..!#######..###..###..########..#####..#....|..|....#..#####..####
####..########..####          ##############..###..###..###############..#....|..|....#..####!..!###
####..########..}###          ##############..###X.###..##############{..#....|..|....#..##vv#..#vv#
###{..########..####          ####&#########.X###..###..#########..T###..#....|..|....#..##..#..#..#
###!..!######!..!####         ###!..![#!####..###..###X.#####[##!...###..!..########..!..#!..!..!..#
#...................#         ##&..............X....................##.......|XXXX|................#
#...................#         ###....................X............!###.......|XXXX|................#
###!..!##XX#]!..!####         ###!..!##!####..########..########..}####..!##[##########..#!..!..!..#
####..###XX###..####          ####..########..########..########..#####......|XXXX|...#..##........#
####..##w..w##..####          ###{..########..########..########..#####......|XXXX|...#^^###]#^^#]##
####..#>....<#..####          ###!..!#######..########..########..########..########..##############
####..#>....<#..############################..########..#######!..!######!..!#######..##############
####..##w..w##..############################..########..}#####......#####{..#####..|..|..###########
####..###XX###..###########################{..########..####!........!####..#####..|..|..###########
#[#!--!##XX##!..!#######!##[#!![######[!###!..!######!--!###{..@..@..}!##!..!##!#--+--+--#![######[#
#...................###!...................|..|....................................|]!|............#
#...................####...................|..|....................................|![|............#
###!--!##]###!..!#######..!##!!##!..!##!###!..!#####]!--!###{..@..@..}!##!##!]#!#--+--+--#!##!..!###
####..########..}#######..########..########..########..####!........!###########..|..|..#####..####
###{..########..#######{..########..}#######..##p..p##..######......#############..|..|..#####..}###
####..########..#######!..!######!..!#######..#!....!#..#######!..!#################..#######!..!###
   ####   ####..########..#######!..########..#!....!#..#######!..!#################..########..####
          ####..##[##[##..#######...}#######..##s..p##..#######{..########vv########..########..}###
          ####........T...######&...########..###FF###..########..########..#######{..########..####
         ####!...T........!####......![##[#!--!##FF##!..!###!##!..!##!![##..#######!..!######!..!###
         #...........T...............................|..|...................!###...................#
         #....T.........T............................|..|...................####...................#
         ###....T..T..T.....###]!......####!--!##]###!..!###!##!##!]#!!##!..#######!..!##XX#]!..!###
          ##................!#####...!######..########..}#################..}#######..###XX###..####
          #{.T....T...T...T.&####{...######{..########..##################..########..##w..w##..####
          ##....T...T...T...!#####..!#######..########..#################!..!#######..#>....<#..####
          #!.T..............#####!..!######!..!######!..!###          ###!..!#######..#>....<#..####
          #&....T....T..T...}##..|..}######[..#####..|..}###          ####..########..##w..w##..####
          #!.............T..###..|..########..#####..|..####         ####{..########..###XX###..####
         ###.T..T...T......T##!--!..!######!..!#{#!--!..!###         #!##!--!##!#[#!--!##XX##!..!###
         #.............T............########............####         #...|XX|......................#
         #........T.................########............####         #...|XX|......................#
         ####!............!###!--!..!######!..!##!!--!..!###         #!##!--!##!###!--!##]###!..!###
          ####...T...T....#####..|..########..#####..|..####         #####..}#######..########..}###
          ####..##]##]##..#####..|..}#######..]####..|..}###          ####..#######{..########..####
          ####..########..#######!..!######!..!######!..!###          ###!..!#######..########..####
             ####      ####     ######  ###!..!#######..####            ######  ####################
                                        #..|..}######{..####                    ####################
                                       ##..|..########..####                    ####################
                                       #!--!..!######!..!###                    ##############[#####
                                       #......########..####                    ##vvv!.............#
                                       #......########..####                    ##...!.............#
                                       #!--!..!######!..!###                    #!...!...........###
                                       ##..|..########..####                    #&...............}##
                                        #..|..}#######..}###                    #!......!!>.....!###
                                        ###!..!#######..####                    ##.*....!!>.....|.T#
                                          ######     ####                       ##......!!>.....!###
                                                                                #!...............###
                                                                                #&...............}##
                                                                                #!...!...........###
                                                                                ##...!.............#
                                                                                ##^^^!.............#
                                                                                ##############]#####
                                                                                ####################
                                                                                ####################
                                                                                ####################
    </pre>
    <p>
        Note that the bottom right room, which contains the Orb (*), is not connected to the rest of the maze.
        This was a pain to figure out because I thought my code to annotate the entrypoints for rooms could
        be broken, and then after I validated that I thought that maybe I was marking 20x20's adjacent room
        coordinates incorrectly, but even though I found an issue there it didn't solve this problem.
    </p>
    <p>
        The problem ended up being a very silly typo. Basically the way the algorithm works is that it
        places the spawn room at (0,0) in room coordinates (one coordinate = one 10x10 room, so a 20x20 room
        would take up 4 room coordinates), and then keeps adding adjacent rooms that fit
        until it reaches a quota of rooms. Once it reaches the quota, it then goes back through the frontier
        of possible rooms and picks out the coordinate that is as far as possible from the spawn and places
        the exit room there. It then goes back through the frontier and picks out the room farthest from the
        exit and places the orb room there. I was accidentally mismatching coordinates with their entryway
        information when I was pulling values out of the frontier and then putting them back in, so although
        it correctly picked the coordinate farthest from the exit room, it thought it was being connected
        from the right, not the top. Once I fixed this the algorithm worked and I haven't found any other
        problems of this vein.
    </p>
    <p>
        One thing you'll notice from the above maze is that it is a lot more linear than the previous mazes, so
        I had to increase the quota of rooms so that the mazes weren't too easy.
    </p>
    <p>
        Here is a side-by-side comparison of a maze generated by the old algorithm compared to a maze generated
        from the new algorithm. (It might help to reduce the zoom on your browser settings).
    </p>
    <pre>
        OLD MAZE ALGORITHM

                    ##########          ####################                                                                      
   orb room        ##........##         ####.....<>.....}###                                                                      
            >>     #{........}#         ###{....p<>.....####                                                                      
                   ##........##        #####..########..#####                                                                     
                   #....*.....#        #......|......|......#                                                                     
                   #..........#        #......|......|......#                                                                     
                   ##........##        ##-----+------+-----##                                                                     
                   #{........}#        #{.....|......|.....#                                                                      
                   ##........##        ##.....|.&..&.|.....#                                                                      
                    ####..####   ####   #.....|......|.....#                                                                      
                    ####..########..#####.....|......|.....###########                                                            
                    ##v#............}####.....|.&..&.|.....###########                                                            
                    ##FF............#####.....|......|.....}##########                                                            
                   ###F######..#######[##-----+------+-----##[########                                                            
                   #...##.p##..#>.............|......|............####                                                            
                   #...##..##..#>.............|......|............####                                                            
                   ##]##..###..##..##..#####..########..########..####                                                            
                    ###..####..##..##..####{.....<>p....########..}###                                                            
                    ##..#####--##..}#..#####.....<>.....}#######..####                                                            
                    #.......F..F...##XX#####..########..########..####   ####      ####                                           
                   ##..######..######..#####..##################..########..########..####                                        
                   #{..######..######..####...}################{..########..}#######..####                                        
                   ##..##...F..F.......###&...#########..T######..########..#######{..####                                        
                   ##..##..##--######..##......#[##[###...######..######[#..########--#[###                                       
                   #...##..##..##v###.....................##....X..................|XX|...#                                       
                   #...##......##.###...................####.......................|XX|...#                                       
                   ##..#####]####-###..##]#......#####..}#####]#..########..######]#--#####                                       
                    #..................#####...&######..########..########..########..}###                                        
                    #..................####{...#######..########..########..}#######..####                                        
             ####   ####..######[#..########..########..#######>............########..####                                        
          ####..########..########..########..#######!..!#######..##..##############..####                                        
          ###[..######v#............}######{..######......######..##..#####v#######...}###                                        
          ####..######FF............########..####!........!####..##........######&...####                                        
          ####..##{###F######..#######[#####..####{..@..@..}##[#..########..##[##......#[##                                       
          ####.........##.p##..#>.........................................................#                                       
          ####.........##..##..#>.........................................................#                                       
          ####..#####]##..###..##..##..########]##{..@..@..}#########]###########]#......##                                       
          ####..#######..####..##..##..###########!........!########################...&##                                        
          ####..]#####..#####--##..}#..#############......#########################{...###                                        
   ####   ####..#####.......F..F...##XX##############!..!###########################..####                       ####      ####   
####..########..#####..######..######..###############..########..##################[#############################..########..####
###{..########..}###{..######..######..###############..########..}##############............<##################v#............}###
####..########..#####..##...F..F.......##############{..########..###############s##>.........F....#############FF............####
####..######[#..#####..##..##--######..##[######[#####..########--########vv###[#######F##F######..#####vv######F######..#######[#
#...X..................##..##..##v###................|..|...............................##....###..#####.........##.p##..#>......#
#......................##......##.###................|..|...............................##....###..#####.........##..##..#>......#
##]#..########..#####..#####]####-###..#####..########..######]#--########..################..###..#####..#]###]##..###..##..##..#
####..########..#####..................#####..########..###[####..########..################..}##..#####..#######..####..##..##..#
####..########..}####..................#####..}#######..##p..p##..########.......####.........###..#####..######..#####--##..}#..#
###>............########..######[#..########..########..##....##..##########]##XX####-#####...###..####{..#####.......F..F...##XX#
####..##..##############..########..##################..##....##..########...............##...###..#####..#####..######..######..#
####..##..#####v#######{..#######{..##################..##s..p##..########..###..#######.##...###...XXX...####{..######..######..#
####..##........########..########..##################..###FF###..########..###..#######.##...###...XXX...#####..##...F..F.......#
##[#..########..##[#####..########..##[############[##--###FF###..########..###..####....#{...###..########[###..##..##--######..#
#.......................................#......................|..|.........###..####.#.###...###................##..##..##v###..#
#.......................................#......................|..|.........###.......#.......###................##......##.###..#
#########]#################]###]##..##################--###]####..########..###XX#########..#####..############..#####]####-###..#
##################################..##################..########..}#######..##>..####.......####{..######[#####..................#
##################################..}################{..########..########..###XX####.####..#####..###......###..................#
##################################..##################..########..#############.......####..#####..###......######..######[#..####
                                 ####   ####..########..########..#############..####^####..#####..###..##########..#### ######   
                                        ###{..#######...}#######..#############..#########--##v##..###..#########{..####          
                                        ####..######&...#######{..############{..###........##.##..###..##########..####          
                                       #####..#####......#[#####..#############..###..##....##.h#..###..##########..####          
                                       #....................####..####......###..###..##....##-##..###..###.........####          
                                       #....................####..####......###..###..##....|...|.......###.........####          
                                       ########]###]#......#####..######]#--###XX###..##--##########]######..####]######          
                                        ##############...&######..########..###..###..##..##.............X#..###########          
                                        #############{...#######..########--###..###..}#..##....##........#..###########          
                                        ##############..##################..###.......##..##....##........#..###########          
                                                  #vv#..########..########..########..##..##....##.&......#..#####..####          
                                                  #--#..########..########--###.......##........##...........#####..####          
                                                  #.....########..#######{..###..###..########..#################{..####          
                                                  #..###########..#[######--###..###..##[#####FF##########[#######--#[###         
                                                  #..###########.................}##.............................|XX|...#         
                                                  #..##..........................###.............................|XX|...#         
                                                  #...#.##..#######--#####..########..########..##]#####..######]#--#####         
                                                 ##..##.##.....XX....####{..########..########..########..########..}###          
                                                 #{..##.##--##[####..#####..########..########..########..}#######..####          
                                                 ##..##.##...........#####..########..########..########..########..####          
                                                  #...#.##..#######--##vv#..########..########..########..#####  ####             
                                                  #..##.##......###..##--#..########..#####vv#...|XXXX|......}#                   
                                                  #..##.}#..##..###..##.....########..#####..#...|XXXX|......##                   
                                                  #..##.##..##..###..##..###########..#[###..#[#########FF#..##                   
                                                  #...#.....##X.......#..###########.............|XXXX|...#...#                   
                                                  #..#####..#######...#..##......................|XXXX|...}...#                   
                                                  #..#[###..#######..##...#.##..#######--####[##########..#..##                   
                                                  #.........|<##.....##..##.##.....XX....##...|XXXX|...#..#..#                    
                                                  #.........|<##.....#{..##.##--##[####..##...|XXXX|...#..#..#                    
                                                  ####..########..#]###..##.##...........##..########..#..#..#                    
                                                     ####      ###### #...#.##..#######--##..#......#..#..#..#                    
                                                                      #..##.##......###..#{..#..##..#..#..#..#                    
                                                                      #..##.}#..##..###..##..#..##p....#..#..#                    
                                                                      #..##.##..##..###..##..#..######]#..#..##                   
                                                                      #...#.....##X..........#...|XXXX|...#...#                   
                                                                      #..#####..#######......#...|XXXX|...#...#                   
                                                                      #..#[###..#######..##..###[##########..##                   
                                                                      #.........|<##.....##......|XXXX|......#                    
                                                                      #.........|<##.....##......|XXXX|......#                    
                                                                      ####..########..#]######..########..####                    
                                                                         ####      ######    ####   ####..####                    
                                                                                                    ####..####                    
                                                                                                    ##......##                    
                                                                                                    ##......##                    
                                                                                exit room >>        #{......}#                    
                                                                                                    ##......##                    
                                                                                                    ##......##                    
                                                                                                    ####..####                    
                                                                                                    ####oo####                    
                                                                                                    ##########                    
    </pre>
    <pre>
        NEW MAZE ALGORITHM

                                                                                                                        ####################                              
                                                                                                                        #..|..}#####....}###                              
                                                                                                                       ##..|..######2...####                              
                                                                                                                       #!--!..!####......![##                             
                                                                                                                       #......####..........#                             
                                                                                                                       #......####..........#                             
                                                                                                                       #!--!..!####]!......##                             
                                                                                                                       ##..|..########...!##                              
                                                                                                                        #..|..}######{...###                              
                                                                                  ######                        ######  ###!..!#######..!###  ######                      
                                                  ##########                    ###!..!###                    ###!..!#######..########..#######!..!###                    
                                                  ##########                    ####..}###                    ####..########..########..}#######..####                    
                                                  ###.3.#####                  #####..####                   ####{..#######{..########..#######{..#####                   
                                                  ##....![#!#                  #!##!..!###                   #!##!--!##!###!..!######!--!###!##!--!##!#                   
                                                  ##2.......#                  #.....p####                   #...|XX|......|..|................|XX|...#                   
                                                  ##........#                  #......####                   #...|XX|......|..|................|XX|...#                   
                                                  ###!..!##!#                  #!]#!..!###                   #!##!--!##!###!..!#####]!--!###!##!--!##!#                   
                                                  ####..#####                  #####..####                   #####..}#######..########..########..}####                   
                                                  ###{..####                    ####..}###                    ####..########..##p..p##..########..####                    
                                                  ###!..!###                    ###!..!###  ######            ###!..!#######..#!....!#..#######!..!###                    
                                        ##############..###########################!..#######!..!#################..########..#!....!#..########..####                    
                                        ###########..|..|..#####vv################....}#######..###############..|..|..#####..##s..p##..#####..|..|..#                    
                                        ###########..|..|..#####..################2...#######{..#######.3.#####..|..|..#####..###FF###..#####..|..|..#                    
                                        ####!##[#!#--+--+--#![##..##[!####!##[#!#......![#!##!--!##!##....![#!#--+--+--##[#!--!##FF##!..!####--+--+--##                   
                                        ###!.........|]!|.............###!...................|XX|...##2..........|]!|................|..|......|]!|...#                   
                                        ####.........|![|.............####...................|XX|...##...........|![|................|..|......|![|...#                   
                                        ####..!##!#--+--+--#!##!..!##!####..!##!#]!......#!##!--!##!###!..!##!#--+--+--####!--!##]###!..!####--+--+--##                   
                                        ####..#####..|..|..#####..########..########...!######..}#######..#####..|..|..#####..########..}####..|..|..#                    
                                        ###{..#####..|..|..#####..}######{..#######{...#######..#######{..#####..|..|..####{..########..#####..|..|..#                    
                                        ###!..!#######..#######!..!######!..!#######..!######!..!######!..!#######..########..########..########..####                    
                              #############!..!#######..########..#######!..!######!..!###  ######  ####..########..########..########################                    
                              ####vv#######{..########..########..#######[..|..#####..}###          ###{..########..########..########################                    
                             #####..########..########..########..########..|..#####..####          ####..########..########..#########################                   
                             #![##..##[!!##!..!##!####..########..#######!..!--#!##!..!###          ###!..!#######..########..####![######[!![######[!#                   
                             #...........................X............####...........p####          ####...<##....X....X..............................#                   
                             #................................X.......####............####          ##T...####..............X.........................#                   
                             #!##!..!##!!##!##!]#!####..###..###..#######!..!--!!]#!..!###          ###!..!#######..X..X......####!##!..!##!!##!..!##!#                   
                             #####..##################..###.X###.X########..|..#####..####          ####..########........X...########..########..#####                   
                              ####..}#################X.###..###..########..|..#####..}###          ####..}#######.X....X.....########..}#######..}###                    
                              ###!..!#################..###..###..#######!..!######!..!###          ####..########..........X.#######!..!######!..!###                    
                                ######  ##############..###..###..#######!..!######!..!################!..!#######..X....X....F.p####!..#######!..####                    
                                        ##############..###X.###..#######{..#####vv#..#vv#####vv#######[..########...X.....X..######....}#####....}###                    
                                        ###.3.########.X###..###..########..#####..#..#..#####..########..########............######2...######2...####                    
                                        ##....![#!####..###..###X.####!##!..!#[!!..!..!..!![##..#######!..!#{#####..X....X....#####......![##......![##                   
                                        ##2..............X......................................!#######..............................................#                   
                                        ##.....................X................................########....................X.........................#                   
                                        ###!..!##!####..########..####!]#!..!##!!..!..!..!!##!..#######!..!##!####..########..#####]!......##]!......##         orb room     
                                        ####..########..########..########..#####........#####..}#######..########..########..########...!######...!##              v     
                                        ###{..########..########..########..}#####]#^^#]######..########..]#######..########..#######{...######{...###              v     
                                        ###!..!#######..########..#######!..!################!..!######!..!#######..########..########..!#######..!###   ####     ######  
                              ##############..##################..########..#################!..!#######..########..###############[######################..#######!..!###
                              ####vv#####..|..|..##>......w#####..########..#####p......p##........##vv#...|XXXX|......}####..............######vv#####..|..|..##........#
                             #####..#####..|..|..#####..########..###vv###..#######!..!###!.@....@.!#..#...|XXXX|......#####............X.######..#####..|..|..#{..####..#
                             #![##..##[!#--+--+--##[#!..!#######..###..###..#######!..!###{........}#..![#########..!..##[##..!####]###!..##![##..##[!#--+--+--#!..![[!..#
                             #.............|]!|....XXXXXXXX...................................!!...........|XXXX|.............######vv##.................|]!|.......*....#
                             #.............|![|....XXXXXXXX...................................!!...........|XXXX|.............##w.....##.................|![|............#
                             #!##!..!##!#--+--+--####!..!#]#####..###..###..#######!..!###{........}#..!..########..!..##.....######..##..##!##!..!##!#--+--+--#!..!]]!..#
 exit room                   #####..#####..|..|..#####..########..###..###..#######!..!###!.@....@.!#..#....|..|....#..##.....!###[#XX#!..######..#####..|..|..#{..####..#
     v                        ####..}####..|..|..###p.....<###>..............<###s......p##........##..#....|..|....#..##...............X.######..}####..|..|..##........#
     v                ######  ###!..!#######..##################..###..###..########..#######!..!####..#....|..|....#..##..X..............#####!..!#######..#######!..!###
#######################!..!#################..########..########..###..###..#######!..!#######..#####..#....|..|....#..##...!######!..##..#####!..!#######..####  ######  
#######################{..#####p......p#####..##[##[##..######>..............<######..#######{..####{..#....|..|....#..##...########..##..#####{..#####..|..|..#          
########################..#######!..!#######........T...########..###..###..#######{..########..#####..#....|..|....#..##...#######{..##..######..#####..|..|..#          
####################!##!..!##!###!..!######!...T........!#######..###..###..####!##!--!##!###!..!####..!..########..!..##...########..##..##!##!..!#[!#--+--+--##         
################!..................................T...............................|XX|...####..####.......|XXXX|...........########..##.................|]!|...#         
###############!............................T.........T..................X.........|XX|...####..####.......|XXXX|...........}#######..#{.................|![|...#         
####vv###vv#####...#!##!##!]#!###!..!#####....T..T..T.....######..###..###..####!##!--!##!###!..!####..!##[##########..##...!######!..##..##!]#!..!##!#--+--+--##         
###!..!#!..!##!...###############!..!#####.................#####..###^^###..########..}#######..#####......|XXXX|...#..##..X............X.######..#####..|..|..#          
#o....X|X........!#############s......p##{.T....T...T...T.1#####..########..########..########..}####......|XXXX|...#^^##.................######..}####..|..|..#          
#o....X|X........#################..######....T...T...T....#####..########..#######!..!#######..########..########..#################]#########!..!#######..####          
#o....X|X........######!..!######!..!####..T..............######..#######!..!######!..!####vv#..########..########..####            ###     ###!..!###   ####             
#o....X|X........!#####[..#######{..#####2....T....T..T...}####{..#######{..#######{..#####--#..########..#######{..####                    ####..}###                    
###!..!#!..!##!...######..########..#####..............T..######..########..########..#####.....########..########..####                   #####..####                    
####^^###^^####....####!..!#{#!##!..!#[!##.T..T...T......T#####!..!###!##!..!##!####..!##!#..###########..#[#####!..!###                   #!##!..!###                    
###############!....####.............................T......####..####..........####......#..###########......####..####                   #......####                    
################!...####........................T...........####..####..........###!......#..##...............####..####                   #......####                    
#######################!..!##!!]#!..!##!###!............!######!..!###!##!##!]#!####!##]#!#...#.....#######--####!..!###                   #!]#!..!###                    
########################..########..########...T...T....########..#########################..##........XX....#####..####                   #####..####                    
########################..]#######..}#######..##]##]##..########..}#######################{..##.....##[####..#####..}###                    ####..}###                    
#######################!..!######!..!#######..########..########..#########################..##..............#####..####                    ###!..!###                    
                      ######  ###!..########..########..########..####                    #...#.....#######--###########                      ######                      
                              ##....}######{..########..########..####                    #..##.........###..###########                                                  
                              ##2...########..########..###vv###..####                    #..##.....##..###..######..T##                                                  
                             ##......![####!..!#######..###..###..#####                   #..##.....##..###--##[##!...##                                                  
                             #..........####..####....................#                   #...#.....##....|...........##                                                  
                             #..........####..####....................#                   #..#####..##....|.........!###                                                  
                             ##]!......####!..!#######............#####                   #..#[###..#######..#####..}###                                                  
                              ####...!######..########.............<##                    #.........|<##.....#####..####                                                  
                              ###{...#######..}#####>.............####                    #.........|<##.....#####..####                                                  
                              ####..!#######..########.............<##            ######  ####..########..#]######..####                                                  
                                 #####     ####   ##>.............####          ###!..!######!..########..!#############                                                  
                                                  ####.............<##          ####..########............}#######vv####                                                  
                                                  ##>.............####         ####{..#######{............########..####                                                  
                                                 #####............#####        #!##!--!##!!##!..!......!..!##!![##..####                                                  
                                                 #....................#        #...|XX|.............................!###                                                  
                                                 #....................#        #...|XX|.............................####                                                  
                                                 #####..###..###..#####        #!##!--!##!!.....+------+.....!!##!..####                                                  
                                                  ####..###^^###..####         #####..}###{.....|..4.!.|.....#####..}###                                                  
                                                  ####..########..####          ####..#####.....|!!!!!!|...!.#####..####                                                  
                                                  ####..########..####          ###!..!####.!...|!!!!>.|.....####!..!###                                                  
                                                     ####      ####             ###########.....|.<&#33;&#33;&#33;&#33;|...!.###########
                                                                                ###########.!...|!!!!!!|.....##p......p#                
                                                                                ###########.....|.!.3..|.....}###!..!###       
                                                                                ####!##[#!!.....+------+.....!###!..!####                                                 
                                                                                ###!....................................#                                                 
                                                                                ####....................................#                                                 
                                                                                ####..!##!###!..!......!..!######!..!####                                                 
                                                                                ####..#######{............#######!..!###                                                  
                                                                                ###{..########............}####s......p#                                                  
                                                                                ###!..!######!..!######!..!#######..####                                                  
                                                                                  ######  ###!..#######!..!###   ####                                                     
                                                                                          ##....}####..|..}###                                                            
                                                                                          ##2...#####..|..####                                                            
                                                                                         ##......![#!--!..!###                                                            
                                                                                         #................####                                                            
                                                                                         #................####                                                            
                                                                                         ##]!......#!--!..!###                                                            
                                                                                          ####...!###..|..####                                                            
                                                                                          ###{...####..|..}###                                                            
                                                                                          ####################                                                            
    </pre>

    <p>
        And here's a key for what the different ascii symbols mean if you want to take out your magnifying glass
        <table>
            <thead>
                <th>Symbol</th>
                <th>Meaning</th>
            </thead>
            <tr>
                <td>.</td>
                <td>Empty</td>
            </tr>
            <tr>
                <td>#</td>
                <td>Wall</td>
            </tr>
            <tr>
                <td>!</td>
                <td>Wall (Pillar)</td>
            </tr>
            <tr>
                <td>@</td>
                <td>Spawn Point</td>
            </tr>
            <tr>
                <td>X</td>
                <td>Ceiling Crush Trap</td>
            </tr>
            <tr>
                <td>1 2 3 4</td>
                <td>Fireball Shooter (Sun God) facing (left, right, down, up)</td>
            </tr>
            <tr>
                <td>+ | -</td>
                <td>Floor Spike (full, vertical, horizontal)</td>
            </tr>
            <tr>
                <td>F</td>
                <td>Fake Wall</td>
            </tr>
            <tr>
                <td>< ^ > v</td>
                <td>Arrow Trap (left, up, right, down)</td>
            </tr>
            <tr>
                <td>p</td>
                <td>random potion</td>
            </tr>
            <tr>
                <td>w</td>
                <td>random weapon</td>
            </tr>
            <tr>
                <td>[ ] { }</td>
                <td>Torch (down, up, right, left)</td>
            </tr>
            <tr>
                <td>s</td>
                <td>random spell</td>
            </tr>
            <tr>
                <td>*</td>
                <td>orb</td>
            </tr>
            <tr>
                <td>T</td>
                <td>teleporter trap</td>
            </tr>
            <tr>
                <td>o</td>
                <td>exit</td>
            </tr>
        </table>
    </p>

    <p>I think this is probably my favorite thing I've programmed for this project. Something about the ascii representation of the mazes
        makes me geek out and get really excited. I might try and make a old-school style ascii roguelike dungeon crawler in my free time
        after graduation.
    </p>

    <h3>Various Bug Fixes and Enhancements</h3>

    <p>As we went through the playtest our Github issue tracker slowly got longer and longer, so I decided
        to start tackling the various smaller issues that we had discovered previously and during the playtest.
        The biggest fixes were:
    </p>

    <ol>
        <li>I made it so enemies and some vision-based traps can't see invisible players</li>
        <li>I nerfed the homing fireballs so they have a time limit on how long the projectiles home.</li>
        <li>I fixed a bug where dead player's velocities stayed the same after death, which caused some strange behavior with enemies and rendering.</li>
    </ol>

    <h3>Refactor Networking</h3>

    <h4>The Motivation</h4>

    <p>
        Another problem that we ran into during the playtest was that David's laptop lagged immensely upon
        joining the server, and stayed laggy throughout the entire duration of the game. This wasn't even
        normal lag you'd expect from a game, it was completely-unplayable single-digit FPS. I didn't really know
        what was going wrong at the time, especially because this happened two games in a row, but after
        letting it sit for some days I ended up realizing the problems.
    </p>
    <p>
        David was the last person to join in both of the games he lagged out in, and because the server
        started the game immediately as the lobby was full, his game was stuck doing the initial game load
        while the game had already started, building up a queue of packets that his system was never able
        to catch up on.
    </p>
    <p>
        Obviously this was a problem: the fact that the game wasn't waiting for players to fully load in the
        initial state before starting, but this isn't really a networking specific thing on its own. The correct
        behavior would be that the server wouldn't start until all of the client's reported they fully loaded in
        the initial state. But even so David's laptop should have eventually been able to catch up.
        It would be very bad if it were ever possible for someone's computer to get impossibly behind on packets
        such that it could never catch up, so something was definitely sussy in the networking code.
    </p>
    <p>
        In addition, while running the program on my laptop every now and then the game would completely freeze
        up and become totally unresponsive for a bit before catching up by slowly replaying all of the actions
        that had occurred in the interim.
    </p>
    <p>
        And lastly, I knew that the way we were using boost asio was not the best for our application, namely with
        how we were using asynchronous calls rather than synchronous. We had talked to Josh about it around week 3,
        and he had mentioned that we wouldn't really need to be doing the asynchronous model. However, we had already
        gotten the system basically working with the asynchronous callbacks, and I was all networked-out by that point
        and wanted to jump to the other parts of the system.
    </p>

    <h4>The Problem</h4>

    <p>
        The problem with the asynchronous version of the networking wasn't because of race conditions, but from how
        we were orchestrating everything together. We knew that we didn't really want to have a completely separate thread
        handling the networking, because then that opens a whole different can of worms, so the way it worked originally
        was like this: 
    </p>

    <p>On the server side:

        <ol>
            <li>Start game loop</li>
            <li>Go through game loop, queueing up asynchronous callbacks for various packets we want to send</li>
            <li>Reach the end of the game loop, spend the remaining time until the next tick sending out the queued packets
                and handling any incoming packets, and pulling out the events and storing them in a list of incoming events
                for the next game tick
            </li>
            <li>Go back to 1.</li>
        </ol>

        And on the client side:
        <ol>
            <li>Start the frame</li>
            <li>Handle all incoming packets from the server(?) and update game state accordingly</li>
            <li>Go through inputs and queue packets for events the client wants to make</li>
            <li>Render the screen</li>
            <li>Finish the frame, and go back to 1.</li>
        </ol>
    </p>

    <p>The way we were implementing "spend the remaining time until the next tick sending out the queued packets and handling any incoming packets" was
        through a boost asio function called io_context::run_for which takes a time length and runs all asynchronous tasks in the current thread until one of two
        stopping conditions is met:
        <ul>
            <li>There are no more asynchronous tasks to run</li>
            <li>The specified time limit is reached, at which point it stops.</li>
        </ul>
    </p>

    <p>
        This worked totally fine on the server side from what I can see because the time to pass into io_context::run_for was very obvious: just spend
        the time until the next tick handling the network requests. However, on the client side it didn't really work because the client isn't on a similar
        schedule: it should just render frames unbounded and handle incoming packets when they come.
    </p>
    <p>
        The biggest problem with the client side can be encompassed in the function that handled all of the incoming server input. The previous version had
        a line that looked like this:
    </p>
    <pre>
        context.run_for(5ms);
    </pre>
    <p>
        I had put this in at a point when I had misunderstood how run_for works. The first stopping condition, that there are no more asynchronous tasks to run,
        actually never was getting hit with how we had it set up because the asynchronous task to handle an incoming packet would always register another
        asynchronous tasks to handle the next incoming packet in its place, so there was never no more asynchronous tasks to run. So this line essentially
        unconditionally froze the client render loop for 5ms every frame, hardlocking our FPS. Ideally what we would want to do here is handle all incoming packets
        until there are no more, but there was no easy way to express this with how we had everything set up. Also, this is the source of the lag problem with
        David's laptop: every frame it would spend 5ms handling packets, but then spend probably 30-50ms (just guessing) rendering to the screen, during which
        time even more packets arrived, and then spend another 5ms handling packets. So this clearly was an architectural problem, and I knew we just should
        simplify everything and use synchronous functions instead since they were easier to work with and reason about.
    </p>

    <h4>The Fix</h4>

    <p>My first attempt at a fix was very simple: I just rewrote our Session wrapper class to use the sychronous write and read functions, and then went
        through the code running the very sophisticated algorithm of "Replace every instance of 'sendPacketAsync' and 'sendEventAsync' with the new 'sendPacket'
        and 'sendEvent' functions". 
    </p>
    <p>
        Pretty quickly I got this first version working on two lab computers, and immediately without that unconditional 5ms sleep the FPS on the lab computers
        jumped from around 40 to 55/60, and everything seemed to just work. However, when I tried to connect on my laptop the more unstable Wi-Fi network
        made the game very choppy. After some analyzing, I realized that the reason for this was because in most cases it was able to handle all of the incoming
        packets very quickly, but sometimes it would take 200-300ms. I think what was happening was that if a packet got dropped or interfered with, it would
        then have to get retransmitted which would cause a backup of packets which would all arrive at the same time, and then a frame would take ~200-300ms to
        render causing the stuttering.
    </p>
    <p>
        I fixed the stuttering problem on Wi-Fi by modifying the client side code that processes server inputs. In the first implementation, it just handled
        all of the incoming packets until it was done. But my improved version worked (and still works) something like this (in my weird half c++ / half pseuducode):

        <pre>
            static auto defer_time = 5ms;

            auto received_events = session->handleAllIncomingPackets();
            this->event_queue.push_back(received_events);  // if only you could push back another vector in real C++

            auto start_time = std::chrono::system_clock::now();

            bool had_to_defer = false;

            for each event in received_events:
                game_state.update(event);

                auto current_time = std::chrono::system_clock::now();

                if start_time + defer_time < current_time:
                    defer_time *= 2;
                    had_to_defer = true;
                    break;
            
            if not had_to_defer:
                defer_time -= 1ms; // and have logic to not go below 5ms minimum...
        </pre>
    </p>
    <p>
        So now in the case where it can very quickly process all of the incoming events, it will handle all of them in the allotted time and return quickly.
        But if there is a backup of packets, it will defer them to the next frame because its more important to maintain the framerate than handle everything
        that just arrived at this exact moment.
    </p>
    <p>
        In addition, I think this should also solve the problem where the game could forever get behind the incoming packets, because eventually with the 
        exponential growth it will get allocated enough time to handle all of the received packets. And with the linear decay I think with unstable connections
        it should eventually find a sweet spot and hover around that and minimize the stuttering experienced. In my testing, this made it much smoother when
        connecting to a server running on a lab computer from my laptop over Wi-Fi. Even though this really isn't necessary for the demo, this will help
        testing and was satisfying to try and solve. I felt kind of like a real network programmer, and was able to apply my CSE 123 knowledge.
    </p>
    <p>
        Annoyingly, however, this deffering of packets caused a crash caused by a race condition that would occur if the game started before a client
        had handled all of the initial load packets, because those initial load packets got deferred to later frames. (Essentially, the client had its own
        entity ID but not the object associated with its entity id, so it would try and go in the entity table it received from the server but then find
        that there was no entry for their own player object because it hadn't been loaded in). To solve this I just added a flag to disable the deffering of
        packets during the initial load phase.
    </p>

    <h3>Helping Out Around the Block</h3>
    <p>I also helped out around various sections of the codebase.</p>
    <h4>Gil & Lobby UI</h4>
    <p>Gil started working on the GUI for the lobby phase, which also is important because we can use this lobby system to verify that the game cannot
        start until all players have loaded in the initial game data.
    </p>
    <p>
        I'm sure Gil will have a really good writeup on this, so I won't go too much in depth, but essentially I helped him with making sense of my GUI
        library, and thinking of ways to express what he wanted to do within the limited expressive power that the home-cooked-in-5-days-GUI library gives you.
    </p>
    <h4>Anthony & The Sun God</h4>
    <p>
        In addition, I also helped Anthony debug some problems with the Sun God model. Essentially there was a problem where the rotation on our models
        didn't match the coordiante system used for the in game velocity calculations. One common operation we had been doing was setting a facing vector
        by subtracting two vectors, and then intializing projectile velocities from a normalized facing "direction" vector and a speed, but the coordinate
        system our model rotating code was using was different than the coordinate system that the physics engine was using, so the fireballs were coming
        out the side of the Sun God statue's heads.
    </p>
    <p>
        He and I ended up deciding that it made sense for the facing vector to be in terms of the coordinate system that the physics code uses, and then
        when rotating the model just apply a transformation, which leads to this really funny out of context code snippet that we now use to 
        rotate models where we swap the z and x axis and then negate the z value to essentially apply a 90 degree rotation between the two systems.
        <pre>
            void Renderable::rotateAbsolute(const glm::vec3& dir, const glm::vec3& axis) {
                float r = glm::atan(-dir.z, dir.x);
                this->rotation = glm::angleAxis(r, axis);
            }
        </pre>
    </p>
    <h4>Ted & HUD UI</h4>
    <p>
        Another thing I helped out with was Ted's HUD UI. He had made some really nice sprites for the inventory and health bar, but unfortunately
        it was completely wrong on Linux! On windows it was correctly drawing everything in the order they were defined in the GUI code, but for some
        reason on Linux it was doing it in the wrong order, so the background of the health bar was rendering ontop of the actual "ticks" that showed
        what portion was actually filled.
    </p>
    <p>
        I spent some time messing around with the z coordinates of the sprites and trying to make them render correctly, but then this had annoying
        interactions with the blending and transparency of the sprites, so I gave up on it. However, in one of the stack overflow posts I read a person
        said, "Alternatively, you could just render everything in order from bottom to top", which made me think, "Are we not currently doing that??" So
        I checked on the code, and realized that as we registered widgets we were placing them in an std::unordered_map, where they were indexed
        by a uint that counted up for each new widget. After changing this to an std::map, it now works on both Linux and Windows.
    </p>
    <p>
        I'm assuming that in gcc's implementation of std::unordered_map, it was not preserving the ordering of insertion (like you would expect from
        an unordered map), but on MSVC it still does maintain the order of insertion for this specific use case. Who knew!
    </p>
    <h3>Full Screen & Title Screen Improvements</h3>
    <p>The last thing I worked on this week was making full screen actually work in the game, and touch up the loading and title screen.
        One thing we had been wanting to do was get the fire css animation from our websiteinside of the game because we all thought it looked cool. I finally
        bit the bullet and sat down for 3 hours and got it inside of the game. I messed around with ffmpeg for so long trying to get a gif that
        wasn't completely messsed up, because it kept messing with the frame rate for some reason even though I was giving it command line options
        that were supposed to set it. Eventually, however, I got it all working and looking nice (by loading in 156 frames of this animation and then
        manually rendering a different one every 20ms...) But hey, it works! There should be a video of it on the main page.
    </p>
    <p>
        And because I think it is funny, here is the current state of my terminal history after this whole episode... You can see the frustration leaking through.
        <pre>
            9471  ffmpeg -c:v libvpx -i loading_logo.webm -frames:v 1 -c:v libwebp -y loading_logo.webp\n
            9474  ffmpeg -i loading_logo.webm -pix_fmt rgb24 loading_logo.gif\n
            9484  ffmpeg -i loading_logo.gif frame_%d.png
            9517  ffmpeg -i logo_animation.mkv -vf scale=320:-1 -r 10 -f image2pipe -vcodec ppm - | convert -delay 10 -loop 0 - output.gif\n
            9525  history | grep ffmpeg
            9527  ffmpeg -i kden.GIF frame_%d.png
            9553  history | grep ffmpeg
            9555  ffmpeg -i logo_black.mkv frame_%d.png
            9571  history | grep ffmpeg
            9575  history | grep ffmpeg
            9577  history | grep ffmpeg
            9578  ffmpeg -i logo_black.mkv frame_%d.png
            9585  ffmpeg -i logo_black.mkv -vf scale=320:-1 -r 10 -f image2pipe -vcodec ppm - | convert -delay 10 -loop 0 - output.gif
            9591  ffmpeg -ss 5 -i logo_black.mkv -t 10 -pix_fmt rgb24 output.gif\n
            9599  history | grep ffmpeg
            9600  ffmpeg -i logo_black.mkv -pix_fmt rgb24 loading_logo.gif
            9603  history | grep ffmpeg
            9604  ffmpeg -i loading_logo.gif frame_%d.png
            9608  ffmpeg -i loading_logo.gif -vsync 0 frame_%d.png\n\n\n
            9628  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" cropped.gif
            9632  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -vsync=0 cropped-2.gif
            9633  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -vsync 0 cropped-2.gif
            9635  history | grep ffmpeg
            9636  ffmpeg -i cropped-2.gif  frame_%d.png
            9641  history | grep ffmpeg
            9643  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -vsync 0 -r 30 cropped-2.gif
            9644  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 30 cropped-3.gif
            9646  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 60 cropped-3.gif
            9647  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 60 cropped-4.gif
            9648  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 100 cropped-4.gif
            9649  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 100 cropped-5.gif
            9650  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 1 cropped-5.gif
            9651  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 1 cropped-6.gif
            9652  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 1000 cropped-6.gif
            9654  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 1000 cropped-6.gif
            9655  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 1000 cropped-7.gif
            9656  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 10000 cropped-8.gif
            9657  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 10000 -pix_fmt rgb24 cropped-8.gif
            9658  ffmpeg -i loading_logo.gif -vf "crop=624:624:648:163" -r 10000 -pix_fmt rgb24 cropped-9.gif
            9659  history | grep ffmpeg
            9660  ffmpeg -i loading_logo.mkv -vf "crop=624:624:648:163" -pix_fmt rgb24 cropped-10.gif
            9662  ffmpeg -i logo_black.mkv -vf "crop=624:624:648:163" -pix_fmt rgb24 cropped-10.gif
            9664  history | grep ffmpeg
            9665  ffmpeg -i GOOD.gif frame_%d.png
            9667  ffmpeg -i GOOD.gif -vsync 0 frame_%d.png
            9669  ffmpeg -i GOOD.gif -vsync 0 frame_%d.png
            9823  history | grep ffmpeg
            9824  history | grep ffmpeg mp4
            9825  ffmpeg -i new_ui_demo.mkv -codec copy new_ui_demo.mp4\n
            9830  ffmpeg -i out-7.ogv -codec copy new_ui_demo_2.mp4\n
            9831  ffmpeg -i out-7.ogv -vcodec libx264 "new_ui_demo_2.mp4"\n
        </pre>
    </p>

    <h2>If the week went differently than you had planned, what were the reasons?</h2>
    <p>
        The week went about as I had planned, which doesn't really mean much because I didn't really plan it all out that much!
    </p>

    <h2>What are your specific goals for the next week?</h2>
    <ul>
        <li>
            Clean up the informational UI on the game HUD, and add in a compass to point in the direction of the orb
            instead of displaying the distance.
        </li>
        <li>
            Potentially implement an item which reflects Zeus's lightning back at him (possibly a mirror?) if noone else does.
        </li>
        <li>
            Do a lot of playtests, and maybe even pull in some people from outside of the group and get their reactions.
        </li>
    </ul>

    <h2>What did you learn this week, if anything (and did you expect to learn it?)</h2>
    <ul>
        <li>How the opengl depth buffer works</li>
        <li>How to copy paste ffmpeg commands from the Internet</li>
        <li>That I'm <s>bad</s> moderately ok at network programming</li>
        <li>Hades 2 is addicting</li>
    </ul>

    <h2>What is your individual morale (which might be different from the overall group morale)?</h2>
    <p>
        My morale is very high! With full screen implemented and better UI, it is really starting to feel like a real game! Also Gil's
        fantastic music and Coco's art genuinely make me feel excited when listening / playing.
    </p>

    <h2>One Final Strange Thing...</h2>
    <p>
        One last thing.... For some reason the performance on my Windows Desktop with an RTX 3060 is incredibly poor, despite basically every other
        computer all over the map of operating systems and specs not having this problem at the same scale. Even my framework laptop without
        a dedicated GPU is much better. My desktop gets like 20fps when playing, while my laptop gets 50. Ted's windows desktop with an 
        A2000 gets 144fps, and Gil has the exact same Graphics Card as me and is fine. Here is everything that I've tried:
        <ul>
            <li>Explicitly add command line arguments to the cmake to compile with all optimizations</li>
            <li>Go into the NVidia settings and ensure that the program is using the GPU.</li>
            <li>Go into the Nvidia settings and play around with random things.</li>
            <li>Update Nvidia Drivers</li>
            <li>Run from both my HDD and SDD (didn't expect any difference besides load times, and that is what I saw, but still tried anyways...)</li>
            <li>Run through Steam as a non-steam game, because of some random stack overflow thread where they said running the game through steam 
                with the steam overlay made their opengl game perform better.... This unsurprisingly didn't do anything.
            </li>
            <li>Verify my version of opengl is what I'd expect (it is, it is version 4.6, which is the same as Anthony's)</li>
            <li>Disable the lighting effects in the game</li>
        </ul>
    </p>
    <p>The last thing there (the first thing I actually tried) is probably the most interesting. After disabling all of the fancy shaders that calculate
        the point lights, the game was actually still performing bascially just as bad.... But it was still making all of the calls to glUniform passing
        in the shading information, but they just weren't being used by the GPU, so I think it has something to do with the CPU -> GPU data transfer, and
        possibly there is some bad driver or something. I have an AMD Ryzen CPU, so maybe there is something weird happening there, but at this point
        I'm so far out of what I understand and my computer can run any modern game basically fine so I feel like there just has to be something
        wrong in my opengl drivers or something like that. I'm officially stumped, and it makes me kind of sad because it feels so bad to play on my
        Desktop, when it should feel so smooth. :(
    </p>
    <p>(Also, Anthony had an experimental branch with deferred shading, and this did increase performance from the 20fps to around 60, but that is still
        laughably slow compared to his laptop which gets 144fps on that branch currently...)
    </p>
    <p>I'm mildly worried that the demo machines will run into the same problem, although there's no reason to think they will
        other than paranoia, so I'd like to run the games on the demo machines as soon as possible to make sure that isn't a problem.
    </p>
</body>

</html>